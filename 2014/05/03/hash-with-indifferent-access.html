<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1'/>
  <title>Jocellyn's Blog  - Hash with indifferent access</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.css" rel="stylesheet" type="text/css">

  <link href='http://fonts.googleapis.com/css?family=Sue+Ellen+Francisco|Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/main.css" rel="stylesheet">
  <meta name="google-site-verification" content="rnwDRfWLERH4z0UoMfWumemvsRSmRIQTz3dd15flK4k" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>
<body>


<div id="main" role="main" class="container">
  <div class="row">
    <a href="/"><h1 class="title"> Jocellyn's Blog</h1></a>

    <div class="col-md-3 image menu">
      <a href="/">
        <img src="/images/2.jpeg" class="logo" alt="" />
      </a>
      <h2>Recent Articles</h2>
      <ol>
          <li><a href="/2018/02/21/how-much-for-my-next-uber.html">How much for my next Uber? Light intro to machine learning</a> </li>
          <li><a href="/2018/01/25/simple-game-development-with-pixi.html">The simplest game development with Pixi.js</a> </li>
          <li><a href="/2018/01/25/how-did-i-lost-fear-from-recruiters.html">How did I lose fear from recruiters</a> </li>
          <li><a href="/2017/10/30/where-to-find-remote-job.html">Where to find remote job</a> </li>
          <li><a href="/2017/04/16/why-ruby-is-slow.html">Why Ruby is slow?</a> </li>
          <li><a href="/2016/10/18/why-am-i-leaving-msd.html">Why am I leaving MSD</a> </li>
          <li><a href="/2015/11/13/d3-simple-example.html">D3 simple visualization (Visu homework V)</a> </li>
          <li><a href="/2015/10/29/interesting-visualization.html">Interesting visualization (Visu homework IV.)</a> </li>
          <li><a href="/2015/10/21/what-is-wrong-with-that-graph.html">What is wrong with that graph? (Visu homework III.)</a> </li>
          <li><a href="/2015/10/19/cleaning-data-for-visualization.html">Cleaning data for visualization (Visu homework II.)</a> </li>
      </ol>

      <h2>Tags</h2>
      <ol>
          <li><a href="/tags/machine-learning.html">machine learning (1)</a></li>
          <li><a href="/tags/programming.html">programming (21)</a></li>
          <li><a href="/tags/game-development.html">game development (1)</a></li>
          <li><a href="/tags/javascript.html">javascript (4)</a></li>
          <li><a href="/tags/career.html">career (3)</a></li>
          <li><a href="/tags/ruby.html">ruby (14)</a></li>
          <li><a href="/tags/performance.html">performance (1)</a></li>
          <li><a href="/tags/visualization.html">visualization (6)</a></li>
          <li><a href="/tags/haskell.html">haskell (2)</a></li>
          <li><a href="/tags/rails.html">rails (9)</a></li>
          <li><a href="/tags/mongodb.html">mongodb (2)</a></li>
          <li><a href="/tags/sociology.html">sociology (6)</a></li>
          <li><a href="/tags/self-improvement.html">self-improvement (11)</a></li>
          <li><a href="/tags/eu.html">EU (3)</a></li>
          <li><a href="/tags/education.html">education (3)</a></li>
          <li><a href="/tags/love.html">love (1)</a></li>
      </ol>

      <h2>By Year</h2>
      <ol>
        <li><a href="/2018.html">2018 (3)</a></li>
        <li><a href="/2017.html">2017 (2)</a></li>
        <li><a href="/2016.html">2016 (1)</a></li>
        <li><a href="/2015.html">2015 (6)</a></li>
        <li><a href="/2014.html">2014 (15)</a></li>
        <li><a href="/2013.html">2013 (7)</a></li>
        <li><a href="/2012.html">2012 (8)</a></li>
    </ol>


    </div>
    <div class="col-md-7 articles">
        <div class="single-post">

    <h1>Hash with indifferent access</h1>

    <p>Hash with indifferent access is the actual class of Rails params, so
technically speaking it is not just a hash, as <a href="http://jocellyn.cz/2014/04/21/rails-params-it-is-just-a-hash.html">I
wrote</a> :)
The &ldquo;indifferent access&rdquo; sounds scary but I am sure you all know what it
means. When you want to get a value based on a key, the key can be
written as <strong>string as well as symbol.</strong></p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># We will set our new hash with i.a. with one key/value pair</span>
<span class="n">dogs</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">HashWithIndifferentAccess</span><span class="p">.</span><span class="nf">new</span>
<span class="n">dogs</span><span class="p">[</span><span class="ss">:husky</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Matt"</span>

<span class="c1"># we can get the value by both, string and symbol</span>
<span class="n">dogs</span><span class="p">[</span><span class="ss">:husky</span><span class="p">]</span> <span class="c1"># =&gt; "Matt"</span>
<span class="n">dogs</span><span class="p">[</span><span class="s1">'husky'</span><span class="p">]</span> <span class="c1"># =&gt; "Matt"</span>
</code></pre></div>
<p>The string and the symbol is treated as a same thing. If you want to
explicitely convert all the keys to one or other, you can use
<code>stringify_keys</code> or <code>symbolize_keys</code> method. Anyway, if we create a hash
with symbol keys, it will be converted to string internally.</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">symbol_hash</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">HashWithIndifferentAccess</span><span class="p">.</span><span class="nf">new</span>
<span class="n">symbol_hash</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"bar"</span>

<span class="n">symbol_hash</span> <span class="c1"># =&gt; {"foo" =&gt; "bar" }</span>
</code></pre></div>
<p>This is because the []= method is converting keys and values for string
every time it is used. Look at the implementation of that method in
Rails:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">[]=</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="n">regular_writer</span><span class="p">(</span><span class="n">convert_key</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="k">for</span><span class="o">::</span><span class="n">assignment</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">convert_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="n">key</span><span class="p">.</span><span class="nf">kind_of?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span> <span class="n">key</span><span class="p">.</span><span class="nf">to_s</span> <span class="p">:</span> <span class="n">key</span>
<span class="k">end</span>
</code></pre></div>
<p>You should be aware of using regular hashes and hashes with indifferent
access as putting these two together may end up unexpectedly. If you
merge them together and they contain the same keys,
you will end up by having both, not just the later ones. </p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">regular</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span>
<span class="n">regular</span><span class="p">[</span><span class="ss">:one</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">regular</span><span class="p">[</span><span class="ss">:two</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">regular</span> <span class="c1"># =&gt; {:one=&gt;1, :two=&gt;2}</span>

<span class="n">indifferent</span> <span class="o">=</span> <span class="no">HashWithIndifferentAccess</span><span class="p">.</span><span class="nf">new</span>
<span class="n">indifferent</span><span class="p">[</span><span class="ss">:one</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"one"</span>

<span class="n">regular</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">indifferent</span><span class="p">)</span> <span class="c1"># =&gt; {:one=&gt;1, :two=&gt;2, "one"=&gt;"one",</span>
<span class="s2">"two"</span><span class="o">=&gt;</span><span class="s2">"two"</span><span class="p">}</span>
</code></pre></div>
<p>Hovewer, if you do it the opposite way (merging regular into
indifferent) it will do what is expected and we will have the later
values: <code>{&quot;one&quot; =&gt; 1, &quot;two&quot; =&gt; 2}</code> but it will become also an
indifferent hash, so the keys wil be stringified.</p>

<p>P.S. if you want to play with these example in your console, do not
forget to include the hash with indifferent acces like this:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="nb">require</span> <span class="s2">"active_support/hash_with_indifferent_access"</span>
</code></pre></div>
    <hr class="space-maker">


    <div class="social-buttons-wrap">
      <div class="social-buttons">
        <div class="inner-buttons">
          <script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"> </script>
          <br>
          <div class="g-plusone" data-size="tall"></div>
          <br>
          <a href="https://twitter.com/share" class="twitter-share-button" data-related="Jocinka" data-lang="en" data-size="medium" data-count="vertical"> Tweet </a>
          <br>
          <div class="fb-like" data-href="http://jocellyn.cz#{current_article.url}" data-layout="box_count" data-action="like" data-show-faces="true" data-share="true"> </div>
        </div>
      </div>
    </div>

    <div class="row well" id="journey">
        <a href="http://journeyapp.net/" target="_blank">
            <div class="col-md-8">
                <h3> Journey - Think. Write. Grow. </h3>
                <p> Self-improvement app which will help you to focus on your emotions, be positive and stay mindful. </p>
            </div>
            <div class="col-md-4">
                <img src="/images/journey.png" class="journey" alt="" />
            </div>
        </a>
    </div>

    <hr class="space-maker">
    <h1>Comments</h1>
    <div class="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'jocellyncz'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38390510-1', 'jocellyn.cz');
ga('send', 'pageview');

    </script>

    </div>
  </div>
</div>

<div class="invisible">
  <a href="https://plus.google.com/101530780379992796153?rel=author">Google</a>
</div>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38390510-1', 'jocellyn.cz');
ga('send', 'pageview');

</script>
<script type="text/javascript">
var _gauges = _gauges || [];
(function() {
 var t   = document.createElement('script');
 t.type  = 'text/javascript';
 t.async = true;
 t.id    = 'gauges-tracker';
 t.setAttribute('data-site-id', '5364b096eddd5b1500001191');
 t.src = '//secure.gaug.es/track.js';
 var s = document.getElementsByTagName('script')[0];
 s.parentNode.insertBefore(t, s);
 })();
</script>
</body>
</html>

    <script type="text/javascript">
(function() {
 var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
 po.src = 'https://apis.google.com/js/platform.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
 })();
    </script>
    <div id="fb-root"></div>
    <script type="text/javascript">
(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=301963046612249&version=v2.0";
 fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script>
    </script>
    <script type="text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>
