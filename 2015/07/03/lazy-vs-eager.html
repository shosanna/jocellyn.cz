<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1'/>
  <title>Jocellyn's Blog  - Lazy versus Eager</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.css" rel="stylesheet" type="text/css">

  <link href='http://fonts.googleapis.com/css?family=Sue+Ellen+Francisco|Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="../../../stylesheets/main.css" rel="stylesheet" />
  <meta name="google-site-verification" content="rnwDRfWLERH4z0UoMfWumemvsRSmRIQTz3dd15flK4k" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>
<body>


<div id="main" role="main" class="container">
  <div class="row">
    <a href="/"><h1 class="title"> Jocellyn's Blog</h1></a>

    <div class="col-md-3 image menu">
      <a href="/">
        <img src="../../../images/2.jpeg" class="logo" alt="" />
      </a>
      <h2>Recent Articles</h2>
      <ol>
          <li><a href="/2018/02/21/how-much-for-my-next-uber.html">How much for my next Uber? Light intro to machine learning</a> </li>
          <li><a href="/2018/01/25/simple-game-development-with-pixi.html">The simplest game development with Pixi.js</a> </li>
          <li><a href="/2018/01/25/how-did-i-lost-fear-from-recruiters.html">How did I lose fear from recruiters</a> </li>
          <li><a href="/2017/10/30/where-to-find-remote-job.html">Where to find remote job</a> </li>
          <li><a href="/2017/04/16/why-ruby-is-slow.html">Why Ruby is slow?</a> </li>
          <li><a href="/2016/10/18/why-am-i-leaving-msd.html">Why am I leaving MSD</a> </li>
          <li><a href="/2015/11/13/d3-simple-example.html">D3 simple visualization (Visu homework V)</a> </li>
          <li><a href="/2015/10/29/interesting-visualization.html">Interesting visualization (Visu homework IV.)</a> </li>
          <li><a href="/2015/10/21/what-is-wrong-with-that-graph.html">What is wrong with that graph? (Visu homework III.)</a> </li>
          <li><a href="/2015/10/19/cleaning-data-for-visualization.html">Cleaning data for visualization (Visu homework II.)</a> </li>
      </ol>

      <h2>Tags</h2>
      <ol>
          <li><a href="/tags/machine-learning.html">machine learning (1)</a></li>
          <li><a href="/tags/programming.html">programming (21)</a></li>
          <li><a href="/tags/game-development.html">game development (1)</a></li>
          <li><a href="/tags/javascript.html">javascript (4)</a></li>
          <li><a href="/tags/career.html">career (3)</a></li>
          <li><a href="/tags/ruby.html">ruby (14)</a></li>
          <li><a href="/tags/performance.html">performance (1)</a></li>
          <li><a href="/tags/visualization.html">visualization (6)</a></li>
          <li><a href="/tags/haskell.html">haskell (2)</a></li>
          <li><a href="/tags/rails.html">rails (9)</a></li>
          <li><a href="/tags/mongodb.html">mongodb (2)</a></li>
          <li><a href="/tags/sociology.html">sociology (6)</a></li>
          <li><a href="/tags/self-improvement.html">self-improvement (11)</a></li>
          <li><a href="/tags/eu.html">EU (3)</a></li>
          <li><a href="/tags/education.html">education (3)</a></li>
          <li><a href="/tags/love.html">love (1)</a></li>
      </ol>

      <h2>By Year</h2>
      <ol>
        <li><a href="/2018.html">2018 (3)</a></li>
        <li><a href="/2017.html">2017 (2)</a></li>
        <li><a href="/2016.html">2016 (1)</a></li>
        <li><a href="/2015.html">2015 (6)</a></li>
        <li><a href="/2014.html">2014 (15)</a></li>
        <li><a href="/2013.html">2013 (7)</a></li>
        <li><a href="/2012.html">2012 (8)</a></li>
    </ol>


    </div>
    <div class="col-md-7 articles">
        <div class="single-post">

    <h1>Lazy versus Eager</h1>

    <p>There are two main strategies when it comes to evaluation of en expression, regardless of programming language.
This article explains the difference using Haskell and then discusses it with comparison to Ruby.</p>

<p>Lets start with a very simple example: </p>
<div class="highlight"><pre class="highlight haskell"><code>  <span class="n">sqrt</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>
<p>This function counts a square root of an expression <code>2+4</code>. It can do it in two ways:</p>
<div class="highlight"><pre class="highlight haskell"><code><span class="c1">-- 1. variant</span>
<span class="n">sqrt</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">4</span>
<span class="o">=</span> <span class="mi">6</span>
<span class="o">=</span> <span class="kr">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">6</span> <span class="kr">in</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">6</span>
<span class="o">=</span> <span class="mi">36</span>

<span class="c1">-- 2. variant</span>
<span class="n">sqrt</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="o">=</span> <span class="kr">let</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="kr">in</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> 
<span class="o">=</span> <span class="kr">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">6</span> <span class="kr">in</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">6</span>
<span class="o">=</span> <span class="mi">36</span>
</code></pre></div>
<p>In the first variant, the argument is evaluated first. Only when all arguments
are evaluated, the actual function call (in this case sqrt) is invoked.  This
is called <strong>eager</strong> evaluation.</p>

<p>Second variant was different - the function was invoked first and the
unevaluated arguments (in this case (2+4) was passed to it. Only when the
function needed these arguments they were eventually evaluated.  This is
<strong>lazy</strong> evaluation.</p>

<p>Lets see one more example:</p>
<div class="highlight"><pre class="highlight haskell"><code><span class="n">fst</span> <span class="p">((</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">sqrt</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1">-- 1. variant (eager)</span>
<span class="o">=</span> <span class="n">fst</span> <span class="p">((</span><span class="mi">5</span><span class="p">),</span> <span class="n">sqrt</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">=</span> <span class="n">fst</span> <span class="p">((</span><span class="mi">5</span><span class="p">),</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">=</span> <span class="n">fst</span> <span class="p">((</span><span class="mi">5</span><span class="p">),</span> <span class="mi">25</span><span class="p">)</span>
<span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">-- 2. variant (lazy)</span>
<span class="o">=</span> <span class="kr">let</span> <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">sqrt</span> <span class="mi">5</span><span class="p">)</span> <span class="kr">in</span> <span class="n">fst</span> <span class="n">p</span>
<span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>We can see the power of lazy evaluation. The second part of the tuple (<code>sqrt 5</code>)
 was never needed and thus never evaluated. Lazy evaluation is called lazy
because it never does anything just in case. It postpone the evaluation to the very last moment.</p>

<p>In the eager version, because every argument is evaluated in front, the
calculation of sqrt was done even though it was immediately discard (the fst
function asks only for the first argument).</p>

<p>Both of these have their justifications in some situations. Lazy evaluations
brings number of significant benefits. First, which we have just seen, is
simplification of the evaluation.  Another one may be a possibility to work with
seemingly infinite lists. In Haskell, there is no problem in constructing an
infinite list of numbers and then take only some small portion of it. The rest
will never gets evaluated because of the laziness, thus we are safe!</p>
<div class="highlight"><pre class="highlight haskell"><code><span class="n">fst</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="p">]</span>
</code></pre></div>
<p>Haskell uses <strong>lazy evaluation by default</strong>. It is one of its big strength. On
the other hand, we must not forgot the downside.  From the nature of laziness
it is apparent that we can never be sure what part of an expression
will get evaluated and what won&rsquo;t. We can&rsquo;t rely on it.  What if the second
argument, which was discarded in the previous example, contains some kind of
side effects? We would not be able to tell for sure that these side effects
happened. Languages which uses lazy evaluation, like Haskell, thus need to be pure (without any side effects).</p>

<p>Ruby, on the other hand, uses eager evaluation by default. You can see it yourself in this example:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="n">range</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="no">Float</span><span class="o">::</span><span class="no">INFINITY</span>
<span class="n">range</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="p">}.</span><span class="nf">first</span>
<span class="o">==&gt;</span> <span class="n">endless</span> <span class="kp">loop</span>
</code></pre></div>
<p>Ruby would try to evaluate eagerly the range composed of infinite numbers which would, of course, resulted in infinite loop.</p>

<p>In Ruby 2.0 we can now use <strong>lazy</strong> method provided in the Enumerable module,
which gives us just the functionality which we want. If you want to know more
about it, I recommend this <a href="http://patshaughnessy.net/2013/4/3/ruby-2-0-works-hard-so-you-can-be-lazy">nice article</a>
by Pat Shaugnessy. </p>

    <hr class="space-maker">


    <div class="social-buttons-wrap">
      <div class="social-buttons">
        <div class="inner-buttons">
          <script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"> </script>
          <br>
          <div class="g-plusone" data-size="tall"></div>
          <br>
          <a href="https://twitter.com/share" class="twitter-share-button" data-related="Jocinka" data-lang="en" data-size="medium" data-count="vertical"> Tweet </a>
          <br>
          <div class="fb-like" data-href="http://jocellyn.cz#{current_article.url}" data-layout="box_count" data-action="like" data-show-faces="true" data-share="true"> </div>
        </div>
      </div>
    </div>

    <div class="row well" id="journey">
        <a href="http://journeyapp.net/" target="_blank">
            <div class="col-md-8">
                <h3> Journey - Think. Write. Grow. </h3>
                <p> Self-improvement app which will help you to focus on your emotions, be positive and stay mindful. </p>
            </div>
            <div class="col-md-4">
                <img src="../../../images/journey.png" class="journey" alt="" />
            </div>
        </a>
    </div>

    <hr class="space-maker">
    <h1>Comments</h1>
    <div class="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'jocellyncz'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38390510-1', 'jocellyn.cz');
ga('send', 'pageview');

    </script>

    </div>
  </div>
</div>

<div class="invisible">
  <a href="https://plus.google.com/101530780379992796153?rel=author">Google</a>
</div>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38390510-1', 'jocellyn.cz');
ga('send', 'pageview');

</script>
<script type="text/javascript">
var _gauges = _gauges || [];
(function() {
 var t   = document.createElement('script');
 t.type  = 'text/javascript';
 t.async = true;
 t.id    = 'gauges-tracker';
 t.setAttribute('data-site-id', '5364b096eddd5b1500001191');
 t.src = '//secure.gaug.es/track.js';
 var s = document.getElementsByTagName('script')[0];
 s.parentNode.insertBefore(t, s);
 })();
</script>
</body>
</html>

    <script type="text/javascript">
(function() {
 var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
 po.src = 'https://apis.google.com/js/platform.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
 })();
    </script>
    <div id="fb-root"></div>
    <script type="text/javascript">
(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=301963046612249&version=v2.0";
 fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script>
    </script>
    <script type="text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>
